
<!doctype html>
<html lang="ar" dir="rtl"><head>
<meta charset="utf-8"/><meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>ملفي الشخصي – كليات الأصالة</title>
<link rel="stylesheet" href="css/style.css"/><link rel="icon" type="image/x-icon" href="assets/favicon.ico">
<script defer src="assets/common.js"></script>
<style>.tabs{display:flex;gap:8px;margin-bottom:10px;justify-content:center}.tabs a{padding:10px 14px;border:1px solid #eee;border-radius:12px}.tabs a.active{background:#f3f4f6;font-weight:800}.section{display:none}.section.active{display:block}</style>
</head>
<body>
<header class="header">
  <a href="member-home.html" class="brand"><img src="assets/asala-logo.jpg" class="logo">
    <div><div class="title">كليات الأصالة – كلية القانون</div><div class="subtitle">منصة الاختبارات القصيرة</div></div></a>
  <div style="margin-inline-start:auto"><a class="btn" href="member-home.html">رجوع</a></div>
</header>
<main class="container">
  <div class="card">
    <h2 id="title">ملفي الشخصي</h2>
    <div class="tabs">
      <a href="#profile" class="active">الملف</a>
      <a href="#password">تغيير الرقم السري</a>
      <a href="#quizzes">اختباراتي</a>
      <a href="#results">نتائجي</a>
    </div>
    <section id="profile" class="section active"><div id="info" class="note">جاري التحميل…</div></section>
    <section id="password" class="section">
      <div class="form-grid">
        <input id="newPwd" class="input" placeholder="كلمة جديدة">
        <button id="btnChange" class="btn btn-primary" type="button">تغيير</button>
      </div>
    </section>
    <section id="quizzes" class="section"><div id="q"></div></section>
    <section id="results" class="section"><div id="r"></div></section>
  </div>
</main>
<footer class="footer">تم تطوير المنصة بواسطة: د. محمد الشمراني – 2025</footer>
<script>
document.addEventListener('DOMContentLoaded', function(){
  // Tabs
  document.querySelectorAll('.tabs a').forEach(function(a){
    a.addEventListener('click', function(e){
      e.preventDefault();
      document.querySelectorAll('.tabs a').forEach(function(x){x.classList.remove('active');});
      a.classList.add('active');
      document.querySelectorAll('.section').forEach(function(s){s.classList.remove('active');});
      var sel = a.getAttribute('href');
      var sec = document.querySelector(sel); if(sec) sec.classList.add('active');
    });
  });

  // Load user (from query ?id=.. or session)
  var urlId = new URLSearchParams(location.search).get('id');
  var sessionId = localStorage.getItem('asala_current_user');
  var userId = urlId || sessionId;
  var u = userId && getUserById(userId);
  if(!u){ location.href='auth.html'; return; }

  // Render info
  var title = document.getElementById('title');
  var info = document.getElementById('info');
  if(title) title.textContent = 'ملف: ' + (u.name || '');
  if(info) info.innerHTML = '<p><b>الاسم:</b> '+(u.name||'')+'</p>' +
                            '<p><b>البريد:</b> '+(u.email||'')+'</p>' +
                            '<p><b>القسم:</b> '+(u.dept||'-')+'</p>' +
                            '<p><b>تاريخ الإنشاء:</b> '+(u.createdAt||'-')+'</p>';

  // Change password
  var btn = document.getElementById('btnChange');
  var newPwd = document.getElementById('newPwd');
  if(btn) btn.addEventListener('click', function(){
    if(!newPwd || !newPwd.value){ alert('أدخل كلمة جديدة'); return; }
    if(setUserPassword(u.id, newPwd.value)){ alert('تم تغيير كلمة المرور'); newPwd.value=''; } else { alert('تعذر تغيير كلمة المرور'); }
  });

  // Quizzes & results for this user
  var qs = listQuizzes().filter(function(x){ return x.owner === u.id; });
  var rs = listResults().filter(function(x){ return x.owner === u.id; });
  var qBox = document.getElementById('q');
  var rBox = document.getElementById('r');
  function renderTable(rows, columns){
    if(!rows.length) return '<p class="note">لا توجد بيانات بعد.</p>';
    var head = '<thead><tr>'+columns.map(function(c){return '<th>'+c+'</th>';}).join('')+'</tr></thead>';
    var body = '<tbody>'+rows.map(function(x){ return '<tr><td>'+(x.id||'')+'</td><td>'+(x.title||x.quizId||'')+'</td><td>'+(x.createdAt||'')+'</td></tr>'; }).join('')+'</tbody>';
    return '<table class="table">'+head+body+'</table>';
  }
  if(qBox) qBox.innerHTML = renderTable(qs, ['ID','العنوان/الاختبار','التاريخ']);
  if(rBox) rBox.innerHTML = renderTable(rs, ['ID','الاختبار/النتيجة','التاريخ']);
});
</script>
</body></html>
