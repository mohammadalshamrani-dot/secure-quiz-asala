
<!doctype html>
<html lang="ar" dir="rtl"><head>
<meta charset="utf-8"/><meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>إنشاء الاختبار – كليات الأصالة</title>
<link rel="stylesheet" href="css/style.css"/><link rel="icon" type="image/x-icon" href="assets/favicon.ico">
<script defer src="assets/common.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/qrcodejs/1.0.0/qrcode.min.js"></script>
<style>.frame{height:900px;border:1px solid #eee;border-radius:14px;overflow:hidden;background:#fff}.grid{display:grid;gap:10px;grid-template-columns:1fr auto}</style>
</head>
<body>
<header class="header">
  <a href="member-home.html" class="brand"><img src="assets/asala-logo.jpg" class="logo">
    <div><div class="title">كليات الأصالة – كلية القانون</div><div class="subtitle">منصة الاختبارات القصيرة</div></div></a>
  <div style="margin-inline-start:auto"><a class="btn" href="member-home.html">رجوع</a></div>
</header>
<main class="container">
  <div class="card">
    <h2>منصة إنشاء الاختبار</h2>
    <p class="note">تُعرض أدناه المنصة الخارجية. بعد إنشاء الاختبار انسخ رابط الاختبار ثم خزّنه وولّد له باركود من الأدوات أسفل الإطار.</p>
    <div class="frame"><iframe src="https://secure-quiz-asala-1.onrender.com" width="100%" height="100%" style="border:0"></iframe></div>
  </div>
  
  <div class="card">
    <h3>بيانات الاختبار (حفظ تلقائي)</h3>
    <form id="qf" class="form-grid">
      <label>عنوان الاختبار</label>
      <input name="title" class="input" placeholder="أدخل عنوانًا واضحًا">
      <label>رابط الاختبار (انسخه من المنصة بالأعلى)</label>
      <input name="link" class="input" placeholder="https://...">
      <p id="savedHint" class="note" style="display:none">تم الحفظ تلقائيًا.</p>
    </form>
  </div>
</main>
<footer class="footer">تم تطوير المنصة بواسطة: د. محمد الشمراني – 2025</footer>
<script>
const uid = localStorage.getItem('asala_current_user'); if(!uid){ location.href='auth.html'; }
const form = document.getElementById('qf'); const hint = document.getElementById('savedHint');
let currentId = null; let debounce;

function autoSave(){
  const fd=new FormData(form);
  const title=(fd.get('title')||'').trim();
  const link=(fd.get('link')||'').trim();
  if(!title && !link){ return; }
  if(!currentId){ currentId = 'q_'+Date.now(); }
  const q={ id: currentId, owner:uid, title, link, createdAt: new Date().toISOString() };
  saveQuiz(q);
  hint.style.display='block';
  clearTimeout(window.__hideHint); window.__hideHint = setTimeout(()=>{ hint.style.display='none'; }, 1200);
}

form.addEventListener('input', ()=>{
  clearTimeout(debounce);
  debounce = setTimeout(autoSave, 400);
});
</script>
</body></html>

<footer class="footer">تم تطوير المنصة بواسطة: د. محمد الشمراني – 2025</footer>
<script>
const uid = localStorage.getItem('asala_current_user'); if(!uid){ location.href='auth.html'; }
const form = document.getElementById('qf'); const qrBox=document.getElementById('qrBox');
form.addEventListener('submit',(e)=>{
  e.preventDefault();
  const fd=new FormData(form);
  const title=fd.get('title').trim(), link=fd.get('link').trim();
  if(!/^https?:\/\//.test(link)){ alert('فضلاً أدخل رابطًا صحيحًا يبدأ بـ https://'); return; }
  const q={id:'q_'+Date.now(), owner:uid, title, link, createdAt:new Date().toISOString()};
  saveQuiz(q);
  // Generate QR
  qrBox.style.display='block';
  document.getElementById('qrcode').innerHTML='';
  new QRCode(document.getElementById('qrcode'), {text: link, width: 220, height: 220});
  alert('تم حفظ بيانات الاختبار.');
});
</script>
</body></html>
