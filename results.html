<!doctype html>
<html lang="ar" dir="rtl">
<head>
  <meta charset="utf-8"/><meta name="viewport" content="width=device-width, initial-scale=1"/>
  <title>نتائج الطلاب</title>
  <link rel="stylesheet" href="style.css"/>
</head>
<body>
  
<header>
  <div class="container header-inner">
    <div class="brand">
      <img src="logo.png" alt="شعار الأصالة" />
      <div class="title">كليات الأصالة – كلية القانون</div>
    </div>
    <nav>
      <a href="index.html">الرئيسية</a>
      <a href="instructions.html">تعليمات سريعة</a>
      <a href="contact.html">تواصل مع الإدارة</a>
      <a href="login.html">دخول أعضاء هيئة التدريس</a>
      <a href="admin.html">الإدارة</a>
    </nav>
  </div>
</header>

  
<main class="container">
  <h2>نتائج الطلاب</h2>
  <div id="guard" class="warning" style="display:none">الرجاء تسجيل الدخول للاطلاع على نتائج طلابك.</div>
  <div id="wrap"></div>
</main>

  <footer class="footer">تم تطوير المنصة بواسطة د. محمد الشمراني – 2025 · جميع الحقوق محفوظة</footer>
  
<script>
  const me=JSON.parse(localStorage.getItem('currentUser')||'null');
  if(!me) guard.style.display='block';
  const data=JSON.parse(localStorage.getItem('studentResults')||'[]');
  const my=data.filter(r=> me && (me.role==='admin' || r.owner===me.username));
  const wrap=document.getElementById('wrap');
  if(my.length===0) wrap.innerHTML='<div class="notice">لا توجد نتائج حتى الآن.</div>';
  else {
    const groups={};
    my.forEach(r=>{ (groups[r.quizTitle]=groups[r.quizTitle]||[]).push(r); });
    Object.keys(groups).forEach((title,i)=>{
      const list=groups[title];
      const card=document.createElement('div'); card.className='card';
      card.innerHTML='<h3>'+title+'</h3>';
      const table=document.createElement('table'); table.className='table';
      table.innerHTML='<tr><th>الطالب</th><th>الرقم</th><th>الدرجة</th><th>ص/خ</th><th>ملاحظة</th></tr>';
      let sum=0, countScore=0;
      list.forEach(r=>{
        const tr=document.createElement('tr');
        let note = r.exited ? 'خرج من المنصة أثناء الاختبار' : '';
        tr.innerHTML='<td>'+r.student.name+'</td><td>'+r.student.id+'</td><td><b>'+r.score+'%</b></td><td>'+r.correct+' / '+r.total+'</td><td>'+note+'</td>';
        table.appendChild(tr);
        if(!r.exited){ sum+=r.score; countScore++; }
      });
      card.appendChild(table);
      const avg = countScore? Math.round(sum/countScore) : 0;
      const div=document.createElement('div'); div.className='notice';
      div.innerHTML='متوسط الدرجة (يستبعد المنسحبين): <b>'+avg+'%</b> – إجمالي المحاولات: '+list.length;
      card.appendChild(div);
      wrap.appendChild(card);
    });
  }
</script>

</body></html>