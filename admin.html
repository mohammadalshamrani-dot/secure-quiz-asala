<!doctype html>
<html lang="ar" dir="rtl">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>لوحة التحكم</title>
  <link rel="stylesheet" href="./style.css">
  <script defer src="./app.js"></script>
</head>
<body>
  <header class="container">
    <div class="header">
      <img src="./assets/logo.svg" alt="شعار الأصالة">
      <nav>
        <a class="btn secondary" href="./help.html">التعليمات</a>
        <a class="btn secondary" href="./contact.html">التواصل</a>
      </nav>
    </div>
  </header>
  <main class="container">
    <div class="card" id="login">
      <h3>تسجيل الدخول</h3>
      <div style="display:grid;grid-template-columns:1fr 1fr;gap:12px">
        <div><label class="label">اسم المستخدم</label><input class="input" id="u" value="admin"></div>
        <div><label class="label">كلمة المرور</label><input class="input" id="p" type="password" value="AaBbCc123"></div>
      </div>
      <div style="margin-top:10px">
        <button class="btn" id="go">دخول</button>
        <span id="ls" class="small"></span>
      </div>
    </div>

    <div id="panel" style="display:none">
      <div class="card">
        <h3>الوارد من نموذج التواصل</h3>
        <table class="table" id="inbox">
          <thead><tr><th>المرسل</th><th>الفئة</th><th>الصفة</th><th>الحالة</th><th>إجراء</th></tr></thead>
          <tbody></tbody>
        </table>
      </div>

      <div class="card">
        <h3>الرد على رسالة</h3>
        <div style="display:grid;grid-template-columns:1fr 2fr;gap:12px">
          <div><label class="label">رقم الرسالة</label><input class="input" id="rid"></div>
          <div><label class="label">نص الرد</label><textarea class="input" id="rtext" rows="4"></textarea></div>
        </div>
        <div style="margin-top:10px"><button class="btn" id="send">إرسال الرد</button> <span id="rs" class="small"></span></div>
      </div>

      <div class="card">
        <h3>تغيير كلمة المرور للأدمن</h3>
        <div style="display:flex;gap:10px">
          <input class="input" id="np" type="password" placeholder="كلمة مرور جديدة (6 أحرف على الأقل)">
          <button class="btn" id="chg">تحديث</button>
        </div>
        <div class="small">الافتراضية: AaBbCc123</div>
      </div>
    </div>
  </main>

  <script>
    const go = document.getElementById('go');
    const login = document.getElementById('login');
    const panel = document.getElementById('panel');
    const ls = document.getElementById('ls');

    go.addEventListener('click', ()=>{
      const u = document.getElementById('u').value.trim();
      const p = document.getElementById('p').value;
      if(adminLogin(u,p)){
        login.style.display='none'; panel.style.display='block'; renderInbox();
      }else{ ls.textContent='بيانات الدخول غير صحيحة'; }
    });

    function renderInbox(){
      const tb = document.querySelector('#inbox tbody');
      tb.innerHTML='';
      for(const m of listInbox()){
        const tr = document.createElement('tr');
        tr.innerHTML = `<td>${m.name}<div class="small">${m.email}</div></td>
                        <td>${m.category}</td><td>${m.role}</td>
                        <td>${m.status}</td>
                        <td><button class="btn secondary" data-id="${m.id}">كمقروء</button></td>`;
        tb.appendChild(tr);
      }
      tb.querySelectorAll('button').forEach(b=>{
        b.addEventListener('click', ()=>{ setMessageStatus(b.dataset.id,'read'); renderInbox(); });
      });
    }

    document.getElementById('send').addEventListener('click', ()=>{
      const id = document.getElementById('rid').value.trim();
      const txt = document.getElementById('rtext').value.trim();
      const rs = document.getElementById('rs');
      if(!id || !txt){ rs.textContent='أدخل رقم الرسالة والنص.'; return; }
      addReply(id, txt); rs.textContent='✓ تم تسجيل الرد.'; renderInbox();
    });

    document.getElementById('chg').addEventListener('click', ()=>{
      const np = document.getElementById('np').value;
      if(np && np.length>=6){ adminChangePassword(np); alert('تم تحديث كلمة المرور.'); }
      else alert('أدخل كلمة مرور لا تقل عن 6 أحرف.');
    });
  </script>
</body>
</html>
